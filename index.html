<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Êó•Êú¨ÊóÖÈÅä‰∏≠Êó•ÁøªË≠ØÂ∞èÂç°Áâá - Èõ¢Á∑öÂèØÁî®">
  <meta name="theme-color" content="#0f0f1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Êó•ÊóÖÁøªË≠ØÂç°Áâá</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üáØüáµ</text></svg>">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f0f1a;
      --bg-secondary: #1a1a2e;
      --bg-card: rgba(30, 30, 50, 0.85);
      --bg-list: rgba(15, 15, 26, 0.98);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --accent-pink: #e94560;
      --accent-gold: #f5a623;
      --glass-border: rgba(255, 255, 255, 0.1);
    }
    .light-mode {
      --bg-primary: #f5f5f7;
      --bg-secondary: #ffffff;
      --bg-card: rgba(255, 255, 255, 0.9);
      --bg-list: rgba(245, 245, 247, 0.98);
      --text-primary: #1a1a2e;
      --text-secondary: rgba(26, 26, 46, 0.7);
      --glass-border: rgba(0, 0, 0, 0.1);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { 
      height: 100%; 
      overflow: hidden;
      touch-action: manipulation;
    }
    body {
      font-family: 'Noto Sans TC', 'Noto Sans JP', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
    }
    .app {
      display: flex;
      height: 100%;
      height: 100dvh;
      position: relative;
    }
    /* ÈÅÆÁΩ© */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 90;
    }
    .overlay.show { display: block; }
    /* Â∑¶ÂÅ¥ÂàóË°® */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 240px;
      background: var(--bg-list);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      z-index: 100;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    .sidebar.open { transform: translateX(0); }
    @media (min-width: 768px) {
      .sidebar {
        position: relative;
        transform: translateX(0);
        width: 220px;
      }
      .overlay { display: none !important; }
      .menu-toggle { display: none !important; }
    }
    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
      font-weight: 700;
    }
    .logo-icon { font-size: 1.25rem; }
    .close-sidebar {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
    }
    @media (max-width: 767px) {
      .close-sidebar { display: block; }
    }
    .category-tabs {
      display: flex;
      padding: 8px;
      gap: 4px;
      border-bottom: 1px solid var(--glass-border);
    }
    .category-tab {
      flex: 1;
      padding: 10px 4px;
      background: transparent;
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .category-tab.active {
      background: var(--accent-pink);
      color: #fff;
      border-color: var(--accent-pink);
    }
    .card-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
      -webkit-overflow-scrolling: touch;
    }
    .card-list::-webkit-scrollbar { width: 3px; }
    .card-list::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 2px; }
    .card-item {
      padding: 14px 12px;
      margin-bottom: 4px;
      background: transparent;
      border: 1px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-item:active { transform: scale(0.98); }
    .card-item.active {
      background: var(--accent-pink);
      color: #fff;
      border-color: var(--accent-pink);
    }
    .card-item-text {
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-item-fav {
      font-size: 0.7rem;
      opacity: 0;
      flex-shrink: 0;
    }
    .card-item.favorited .card-item-fav { opacity: 1; }
    /* Âè≥ÂÅ¥‰∏ªÂçÄÂüü */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 12px;
      padding-top: env(safe-area-inset-top, 12px);
      padding-bottom: env(safe-area-inset-bottom, 12px);
      overflow: hidden;
      min-width: 0;
    }
    .main-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .menu-toggle {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      width: 44px;
      height: 44px;
      font-size: 1.3rem;
      cursor: pointer;
      flex-shrink: 0;
    }
    .search-container {
      position: relative;
      flex: 1;
      min-width: 0;
    }
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      opacity: 0.5;
    }
    .search-input {
      width: 100%;
      padding: 12px 12px 12px 38px;
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
    }
    .search-input::placeholder { color: var(--text-secondary); }
    .search-input:focus { outline: none; border-color: var(--accent-pink); }
    .header-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }
    .icon-btn {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      width: 44px;
      height: 44px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .icon-btn:active { transform: scale(0.95); }
    .icon-btn.active { background: var(--accent-pink); border-color: var(--accent-pink); }
    /* Âç°ÁâáÂçÄÂüü */
    .card-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1000px;
      padding: 10px;
      min-height: 0;
    }
    .card {
      width: 100%;
      max-width: 400px;
      aspect-ratio: 3/2;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }
    .card.flipped { transform: rotateY(180deg); }
    .card-face {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    }
    .card-back { transform: rotateY(180deg); }
    .zh-text {
      font-size: clamp(1.5rem, 6vw, 2.5rem);
      font-weight: 700;
      text-align: center;
      line-height: 1.3;
    }
    .hint {
      position: absolute;
      bottom: 16px;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    .ja-text {
      font-size: clamp(1.3rem, 5vw, 2rem);
      font-weight: 700;
      text-align: center;
      line-height: 1.4;
      color: var(--accent-pink);
    }
    .romaji-text {
      margin-top: 12px;
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      color: var(--text-secondary);
      text-align: center;
    }
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      color: var(--text-secondary);
    }
    .empty-icon { font-size: 2.5rem; }
    /* Â∫ïÈÉ®ÊéßÂà∂ */
    .card-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 16px 0;
    }
    .nav-btn {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.15s;
    }
    .nav-btn:active { transform: scale(0.92); }
    .favorite-btn {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.15s;
      filter: grayscale(1) opacity(0.5);
    }
    .favorite-btn.active { 
      filter: none; 
      background: var(--accent-gold); 
      border-color: var(--accent-gold); 
    }
    .favorite-btn.pop { transform: scale(1.15); }
    .progress-text {
      font-size: 0.95rem;
      color: var(--text-secondary);
      min-width: 55px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="overlay"></div>
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üáØüáµ</span>
          <span>Êó•ÊóÖÁøªË≠ØÂç°Áâá</span>
        </div>
        <button class="close-sidebar" aria-label="ÈóúÈñâ">‚úï</button>
      </div>
      <nav class="category-tabs"></nav>
      <div class="card-list"></div>
    </aside>
    <main class="main">
      <div class="main-header">
        <button class="menu-toggle" aria-label="ÈñãÂïüÈÅ∏ÂñÆ">‚ò∞</button>
        <div class="search-container">
          <span class="search-icon">üîç</span>
          <input type="text" class="search-input" placeholder="ÊêúÂ∞ã..." autocomplete="off">
        </div>
        <div class="header-actions">
          <button class="icon-btn fav-filter-btn" aria-label="Âè™È°ØÁ§∫Êî∂Ëóè">üìã</button>
          <button class="icon-btn theme-toggle" aria-label="ÂàáÊèõ‰∏ªÈ°å">‚òÄÔ∏è</button>
        </div>
      </div>
      <div class="card-container">
        <div class="card">
          <div class="card-face card-front">
            <span class="zh-text">ËºâÂÖ•‰∏≠...</span>
            <span class="hint">üëÜ ÈªûÊìäÁøªËΩâ</span>
          </div>
          <div class="card-face card-back">
            <span class="ja-text"></span>
            <span class="romaji-text"></span>
          </div>
        </div>
      </div>
      <div class="card-controls">
        <button class="nav-btn prev-btn" aria-label="‰∏ä‰∏ÄÂºµ">‚Üê</button>
        <span class="progress-text">1/20</span>
        <button class="favorite-btn" aria-label="Êî∂Ëóè">‚≠ê</button>
        <button class="nav-btn next-btn" aria-label="‰∏ã‰∏ÄÂºµ">‚Üí</button>
      </div>
    </main>
  </div>
  <script>
    const cardsData = {
      dining: {
        name: 'È§êÈ£≤', icon: 'üçú',
        cards: [
          { zh: 'Ë´ãÁµ¶ÊàëËèúÂñÆ', ja: '„É°„Éã„É•„Éº„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Menyuu wo kudasai' },
          { zh: 'ÊàëË¶ÅÈªûÈ§ê', ja: 'Ê≥®Êñá„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', romaji: 'Chuumon wo onegai shimasu' },
          { zh: 'Êé®Ëñ¶‰ªÄÈ∫ºÔºü', ja: '„Åä„Åô„Åô„ÇÅ„ÅØ‰Ωï„Åß„Åô„ÅãÔºü', romaji: 'Osusume wa nan desu ka?' },
          { zh: 'ÈÄôÂÄãÊòØ‰ªÄÈ∫ºÔºü', ja: '„Åì„Çå„ÅØ‰Ωï„Åß„Åô„ÅãÔºü', romaji: 'Kore wa nan desu ka?' },
          { zh: 'Ë´ãÁµ¶ÊàëÈÄôÂÄã', ja: '„Åì„Çå„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Kore wo kudasai' },
          { zh: 'ÊàëË¶Å‰∏Ä‰ªΩ', ja: '‰∏Ä„Å§„Åè„Å†„Åï„ÅÑ', romaji: 'Hitotsu kudasai' },
          { zh: 'ÊàëË¶ÅÂÖ©‰ªΩ', ja: '‰∫å„Å§„Åè„Å†„Åï„ÅÑ', romaji: 'Futatsu kudasai' },
          { zh: '‰∏çË¶ÅËæ£', ja: 'Ëæõ„Åè„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ', romaji: 'Karaku shinaide kudasai' },
          { zh: 'ÊàëÂ∞ç‚óã‚óãÈÅéÊïè', ja: '‚óã‚óã„Ç¢„É¨„É´„ÇÆ„Éº„Åå„ÅÇ„Çä„Åæ„Åô', romaji: '‚óã‚óã arerugii ga arimasu' },
          { zh: 'Ë´ãÁµêÂ∏≥', ja: '„Åä‰ºöË®à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', romaji: 'Okaikei wo onegai shimasu' },
          { zh: 'ÂèØ‰ª•Âà∑Âç°ÂóéÔºü', ja: '„Ç´„Éº„Éâ„ÅØ‰Ωø„Åà„Åæ„Åô„ÅãÔºü', romaji: 'Kaado wa tsukaemasu ka?' },
          { zh: 'ÂèØ‰ª•ÂàÜÈñã‰ªòÂóéÔºü', ja: 'Âà•„ÄÖ„Å´Êâï„Åà„Åæ„Åô„ÅãÔºü', romaji: 'Betsubetsu ni haraemasu ka?' },
          { zh: 'Ë´ãÁµ¶ÊàëÊî∂Êìö', ja: '„É¨„Ç∑„Éº„Éà„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Reshiito wo kudasai' },
          { zh: 'Â•ΩÂêÉÔºÅ', ja: '„Åä„ÅÑ„Åó„ÅÑÔºÅ', romaji: 'Oishii!' },
          { zh: 'ÊàëÂêÉÈ£Ω‰∫Ü', ja: '„ÅäËÖπ„ÅÑ„Å£„Å±„ÅÑ„Åß„Åô', romaji: 'Onaka ippai desu' },
          { zh: 'Ë´ãÁµ¶ÊàëÊ∞¥', ja: '„ÅäÊ∞¥„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Omizu wo kudasai' },
          { zh: 'Â§ñÂ∏∂', ja: 'ÊåÅ„Å°Â∏∞„Çä', romaji: 'Mochikaeri' },
          { zh: 'ÂÖßÁî®', ja: 'Â∫óÂÜÖ„Åß', romaji: 'Tennai de' },
          { zh: 'ÊúâÁ¥†È£üÂóéÔºü', ja: '„Éô„Ç∏„Çø„É™„Ç¢„É≥„É°„Éã„É•„Éº„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Bejitarian menyuu wa arimasu ka?' },
          { zh: 'Ë´ãÁ≠â‰∏Ä‰∏ã', ja: 'Â∞ë„ÄÖ„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ', romaji: 'Shoushou omachi kudasai' }
        ]
      },
      shopping: {
        name: 'Ë≥ºÁâ©', icon: 'üõçÔ∏è',
        cards: [
          { zh: 'Â§öÂ∞ëÈå¢Ôºü', ja: '„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü', romaji: 'Ikura desu ka?' },
          { zh: 'ÂèØ‰ª•Ë©¶Á©øÂóéÔºü', ja: 'Ë©¶ÁùÄ„Åß„Åç„Åæ„Åô„ÅãÔºü', romaji: 'Shichaku dekimasu ka?' },
          { zh: 'ÊúâÂà•ÁöÑÈ°èËâ≤ÂóéÔºü', ja: '‰ªñ„ÅÆËâ≤„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Hoka no iro wa arimasu ka?' },
          { zh: 'ÊúâÂ§ß‰∏ÄÈªûÁöÑÂóéÔºü', ja: '„ÇÇ„Å£„Å®Â§ß„Åç„ÅÑ„ÅÆ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Motto ookii no wa arimasu ka?' },
          { zh: 'ÊúâÂ∞è‰∏ÄÈªûÁöÑÂóéÔºü', ja: '„ÇÇ„Å£„Å®Â∞è„Åï„ÅÑ„ÅÆ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Motto chiisai no wa arimasu ka?' },
          { zh: 'ÊàëË¶ÅÈÄôÂÄã', ja: '„Åì„Çå„Å´„Åó„Åæ„Åô', romaji: 'Kore ni shimasu' },
          { zh: 'ÊàëÂè™ÊòØÁúãÁúã', ja: 'Ë¶ã„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô', romaji: 'Mite iru dake desu' },
          { zh: 'ÂèØ‰ª•‰æøÂÆú‰∏ÄÈªûÂóéÔºü', ja: 'ÂÆâ„Åè„Å™„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Yasuku narimasu ka?' },
          { zh: 'ÂèØ‰ª•ÈÄÄÁ®ÖÂóéÔºü', ja: 'ÂÖçÁ®é„Åß„Åç„Åæ„Åô„ÅãÔºü', romaji: 'Menzei dekimasu ka?' },
          { zh: 'Ë´ãÂπ´ÊàëÈÄÄÁ®Ö', ja: 'ÂÖçÁ®éÊâãÁ∂ö„Åç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', romaji: 'Menzei tetsuzuki wo onegai shimasu' },
          { zh: 'ÈÄôÊòØÂÖçÁ®ÖÂìÅ', ja: '„Åì„Çå„ÅØÂÖçÁ®éÂìÅ„Åß„Åô', romaji: 'Kore wa menzeihin desu' },
          { zh: 'Ë≠∑ÁÖßÂú®ÈÄôË£°', ja: '„Éë„Çπ„Éù„Éº„Éà„ÅØ„Åì„Å°„Çâ„Åß„Åô', romaji: 'Pasupooto wa kochira desu' },
          { zh: 'ÂèØ‰ª•Áî®ÁèæÈáëÂóéÔºü', ja: 'ÁèæÈáë„ÅßÊâï„Åà„Åæ„Åô„ÅãÔºü', romaji: 'Genkin de haraemasu ka?' },
          { zh: 'Ë´ãÁµ¶ÊàëË¢ãÂ≠ê', ja: 'Ë¢ã„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Fukuro wo kudasai' },
          { zh: '‰∏çÁî®Ë¢ãÂ≠ê', ja: 'Ë¢ã„ÅØË¶Å„Çä„Åæ„Åõ„Çì', romaji: 'Fukuro wa irimasen' },
          { zh: 'Ë´ãÂπ´ÊàëÂåÖË£ù', ja: 'ÂåÖË£Ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ', romaji: 'Housou shite kudasai' },
          { zh: 'ÈÄôÊòØÁ¶ÆÁâ©', ja: '„Éó„É¨„Çº„É≥„ÉàÁî®„Åß„Åô', romaji: 'Purezento you desu' },
          { zh: 'ÁáüÊ•≠Âà∞ÂπæÈªûÔºü', ja: '‰ΩïÊôÇ„Åæ„ÅßÂñ∂Ê•≠„Åó„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü', romaji: 'Nanji made eigyou shite imasu ka?' }
        ]
      },
      hotel: {
        name: '‰ΩèÂÆø', icon: 'üè®',
        cards: [
          { zh: 'ÊàëÊúâÈ†êÁ¥Ñ', ja: '‰∫àÁ¥Ñ„Åå„ÅÇ„Çä„Åæ„Åô', romaji: 'Yoyaku ga arimasu' },
          { zh: 'ÊàëË¶ÅËæ¶ÁêÜÂÖ•‰Ωè', ja: '„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', romaji: 'Chekkuin wo onegai shimasu' },
          { zh: 'ÊàëË¶ÅÈÄÄÊàø', ja: '„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô', romaji: 'Chekku auto wo onegai shimasu' },
          { zh: 'Ë´ãÂïèWiFiÂØÜÁ¢ºÊòØÔºü', ja: 'WiFi„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ‰Ωï„Åß„Åô„ÅãÔºü', romaji: 'WiFi no pasuwaado wa nan desu ka?' },
          { zh: 'ÊàøÈñìÊÄéÈ∫ºËµ∞Ôºü', ja: 'ÈÉ®Â±ã„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü', romaji: 'Heya wa doko desu ka?' },
          { zh: 'ÂèØ‰ª•ÂØÑÊîæË°åÊùéÂóéÔºü', ja: 'Ëç∑Áâ©„ÇíÈ†ê„Åë„Çâ„Çå„Åæ„Åô„ÅãÔºü', romaji: 'Nimotsu wo azukeraremasu ka?' },
          { zh: 'Ë´ãÂπ´ÊàëÂè´Ë®àÁ®ãËªä', ja: '„Çø„ÇØ„Ç∑„Éº„ÇíÂëº„Çì„Åß„Åè„Å†„Åï„ÅÑ', romaji: 'Takushii wo yonde kudasai' },
          { zh: 'Êó©È§êÂπæÈªûÈñãÂßãÔºü', ja: 'ÊúùÈ£ü„ÅØ‰ΩïÊôÇ„Åã„Çâ„Åß„Åô„ÅãÔºü', romaji: 'Choushoku wa nanji kara desu ka?' },
          { zh: 'ÊúâÂêπÈ¢®Ê©üÂóéÔºü', ja: '„Éâ„É©„Ç§„É§„Éº„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Doraiyaa wa arimasu ka?' },
          { zh: 'ÂÜ∑Ê∞£Â£û‰∫Ü', ja: '„Ç®„Ç¢„Ç≥„É≥„ÅåÂ£ä„Çå„Å¶„ÅÑ„Åæ„Åô', romaji: 'Eakon ga kowarete imasu' },
          { zh: 'Ë´ãÊâìÊéÉÊàøÈñì', ja: 'ÈÉ®Â±ã„ÇíÊéÉÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ', romaji: 'Heya wo souji shite kudasai' },
          { zh: 'Ë´ãÁµ¶ÊàëÊØõÂ∑æ', ja: '„Çø„Ç™„É´„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Taoru wo kudasai' },
          { zh: 'Ë´ãÁµ¶ÊàëÁâôÂà∑', ja: 'Ê≠Ø„Éñ„É©„Ç∑„Çí„Åè„Å†„Åï„ÅÑ', romaji: 'Haburashi wo kudasai' },
          { zh: 'ÁÜ±Ê∞¥‰∏çÁÜ±', ja: '„ÅäÊπØ„ÅåÂá∫„Åæ„Åõ„Çì', romaji: 'Oyu ga demasen' },
          { zh: 'ÂèØ‰ª•Âª∂ÂæåÈÄÄÊàøÂóéÔºü', ja: '„É¨„Ç§„Éà„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Åß„Åç„Åæ„Åô„ÅãÔºü', romaji: 'Reito chekku auto dekimasu ka?' },
          { zh: 'ÈôÑËøëÊúâ‰æøÂà©ÂïÜÂ∫óÂóéÔºü', ja: 'Ëøë„Åè„Å´„Ç≥„É≥„Éì„Éã„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', romaji: 'Chikaku ni konbini wa arimasu ka?' }
        ]
      },
      daily: {
        name: 'Êó•Â∏∏', icon: 'üëã',
        cards: [
          { zh: '‰Ω†Â•Ω', ja: '„Åì„Çì„Å´„Å°„ÅØ', romaji: 'Konnichiwa' },
          { zh: 'Ë¨ùË¨ù', ja: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô', romaji: 'Arigatou gozaimasu' },
          { zh: '‰∏çÂ•ΩÊÑèÊÄù', ja: '„Åô„Åø„Åæ„Åõ„Çì', romaji: 'Sumimasen' },
          { zh: 'Â∞ç‰∏çËµ∑', ja: '„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ', romaji: 'Gomen nasai' },
          { zh: 'Ë´ã', ja: '„Å©„ÅÜ„Åû', romaji: 'Douzo' },
          { zh: 'ÊòØÁöÑ', ja: '„ÅØ„ÅÑ', romaji: 'Hai' },
          { zh: '‰∏çÊòØ', ja: '„ÅÑ„ÅÑ„Åà', romaji: 'Iie' },
          { zh: 'Êàë‰∏çÊáÇÊó•Êñá', ja: 'Êó•Êú¨Ë™û„Åå„Çè„Åã„Çä„Åæ„Åõ„Çì', romaji: 'Nihongo ga wakarimasen' },
          { zh: 'Ë´ãË™™ÊÖ¢‰∏ÄÈªû', ja: '„ÇÜ„Å£„Åè„ÇäË©±„Åó„Å¶„Åè„Å†„Åï„ÅÑ', romaji: 'Yukkuri hanashite kudasai' },
          { zh: 'Ë´ãÂØ´‰∏ã‰æÜ', ja: 'Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ', romaji: 'Kaite kudasai' },
          { zh: 'ÂªÅÊâÄÂú®Âì™Ë£°Ôºü', ja: '„Éà„Ç§„É¨„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü', romaji: 'Toire wa doko desu ka?' },
          { zh: 'Á≠â‰∏Ä‰∏ã', ja: '„Å°„Çá„Å£„Å®ÂæÖ„Å£„Å¶„Åè„Å†„Åï„ÅÑ', romaji: 'Chotto matte kudasai' },
          { zh: 'Ê≤íÈóú‰øÇ', ja: 'Â§ß‰∏àÂ§´„Åß„Åô', romaji: 'Daijoubu desu' },
          { zh: 'ÂÜçË¶ã', ja: '„Åï„Çà„ÅÜ„Å™„Çâ', romaji: 'Sayounara' }
        ]
      }
    };

    class App {
      constructor() {
        this.currentCategory = 'dining';
        this.currentIndex = 0;
        this.favorites = JSON.parse(localStorage.getItem('jp_favorites') || '[]');
        this.searchQuery = '';
        this.filteredCards = [];
        this.isDarkMode = localStorage.getItem('jp_darkMode') !== 'false';
        this.showingFavoritesOnly = false;
      }
      init() {
        this.cacheElements();
        this.bindEvents();
        this.applyTheme();
        this.renderCategories();
        this.updateCards();
        this.initTouch();
      }
      cacheElements() {
        this.cardElement = document.querySelector('.card');
        this.cardFront = document.querySelector('.card-front');
        this.cardBack = document.querySelector('.card-back');
        this.categoryTabs = document.querySelector('.category-tabs');
        this.cardList = document.querySelector('.card-list');
        this.searchInput = document.querySelector('.search-input');
        this.favoriteBtn = document.querySelector('.favorite-btn');
        this.prevBtn = document.querySelector('.prev-btn');
        this.nextBtn = document.querySelector('.next-btn');
        this.progressText = document.querySelector('.progress-text');
        this.themeToggle = document.querySelector('.theme-toggle');
        this.favFilterBtn = document.querySelector('.fav-filter-btn');
        this.sidebar = document.querySelector('.sidebar');
        this.overlay = document.querySelector('.overlay');
        this.menuToggle = document.querySelector('.menu-toggle');
        this.closeSidebar = document.querySelector('.close-sidebar');
      }
      bindEvents() {
        this.searchInput.addEventListener('input', (e) => {
          this.searchQuery = e.target.value.trim();
          this.currentIndex = 0;
          this.updateCards();
        });
        this.favoriteBtn.addEventListener('click', () => this.toggleFavorite());
        this.prevBtn.addEventListener('click', () => this.prevCard());
        this.nextBtn.addEventListener('click', () => this.nextCard());
        this.themeToggle.addEventListener('click', () => this.toggleTheme());
        this.favFilterBtn.addEventListener('click', () => this.toggleFavoriteFilter());
        this.cardElement.addEventListener('click', () => this.cardElement.classList.toggle('flipped'));
        // Sidebar
        this.menuToggle.addEventListener('click', () => this.openSidebar());
        this.closeSidebar.addEventListener('click', () => this.closeSidebarFn());
        this.overlay.addEventListener('click', () => this.closeSidebarFn());
        // Keyboard
        document.addEventListener('keydown', (e) => {
          if (e.target === this.searchInput) return;
          if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); this.prevCard(); }
          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { e.preventDefault(); this.nextCard(); }
          if (e.key === ' ') { e.preventDefault(); this.cardElement.classList.toggle('flipped'); }
          if (e.key === 'Escape') this.closeSidebarFn();
        });
      }
      openSidebar() {
        this.sidebar.classList.add('open');
        this.overlay.classList.add('show');
      }
      closeSidebarFn() {
        this.sidebar.classList.remove('open');
        this.overlay.classList.remove('show');
      }
      initTouch() {
        let startX = 0, startY = 0;
        this.cardElement.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        }, { passive: true });
        this.cardElement.addEventListener('touchend', (e) => {
          const diffX = e.changedTouches[0].clientX - startX;
          const diffY = e.changedTouches[0].clientY - startY;
          if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
            if (diffX < 0) this.nextCard();
            else this.prevCard();
          }
        }, { passive: true });
      }
      renderCategories() {
        const categories = Object.entries(cardsData);
        this.categoryTabs.innerHTML = categories.map(([key, cat]) => `
          <button class="category-tab ${key === this.currentCategory ? 'active' : ''}" data-category="${key}" title="${cat.name}">
            ${cat.icon}
          </button>
        `).join('');
        this.categoryTabs.querySelectorAll('.category-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            this.currentCategory = tab.dataset.category;
            this.currentIndex = 0;
            this.searchQuery = '';
            this.searchInput.value = '';
            this.showingFavoritesOnly = false;
            this.favFilterBtn.classList.remove('active');
            this.updateCategories();
            this.updateCards();
          });
        });
      }
      updateCategories() {
        this.categoryTabs.querySelectorAll('.category-tab').forEach(tab => {
          tab.classList.toggle('active', tab.dataset.category === this.currentCategory);
        });
      }
      getFilteredCards() {
        let cards = cardsData[this.currentCategory].cards.map((card, idx) => ({
          ...card, id: `${this.currentCategory}-${idx}`, index: idx
        }));
        if (this.searchQuery) {
          const query = this.searchQuery.toLowerCase();
          cards = cards.filter(card => card.zh.includes(query) || card.ja.includes(query) || card.romaji.toLowerCase().includes(query));
        }
        if (this.showingFavoritesOnly) {
          cards = cards.filter(card => this.favorites.includes(card.id));
        }
        return cards;
      }
      renderCardList() {
        this.cardList.innerHTML = this.filteredCards.map((card, idx) => `
          <div class="card-item ${idx === this.currentIndex ? 'active' : ''} ${this.favorites.includes(card.id) ? 'favorited' : ''}" data-index="${idx}">
            <span class="card-item-fav">‚≠ê</span>
            <span class="card-item-text">${card.zh}</span>
          </div>
        `).join('');
        this.cardList.querySelectorAll('.card-item').forEach(item => {
          item.addEventListener('click', () => {
            this.currentIndex = parseInt(item.dataset.index);
            this.updateCardDisplay();
            this.updateListActive();
            if (window.innerWidth < 768) this.closeSidebarFn();
          });
        });
        const activeItem = this.cardList.querySelector('.card-item.active');
        if (activeItem) activeItem.scrollIntoView({ block: 'nearest' });
      }
      updateListActive() {
        this.cardList.querySelectorAll('.card-item').forEach((item, idx) => {
          item.classList.toggle('active', idx === this.currentIndex);
        });
        const activeItem = this.cardList.querySelector('.card-item.active');
        if (activeItem) activeItem.scrollIntoView({ block: 'nearest' });
      }
      updateCardDisplay() {
        this.cardElement.classList.remove('flipped');
        if (this.filteredCards.length === 0) {
          this.cardFront.innerHTML = `<div class="empty-state"><span class="empty-icon">üîç</span><p>Êâæ‰∏çÂà∞Âç°Áâá</p></div>`;
          this.cardBack.innerHTML = '';
          this.progressText.textContent = '0/0';
          this.favoriteBtn.classList.remove('active');
          return;
        }
        if (this.currentIndex >= this.filteredCards.length) this.currentIndex = this.filteredCards.length - 1;
        const card = this.filteredCards[this.currentIndex];
        this.cardFront.innerHTML = `<span class="zh-text">${card.zh}</span><span class="hint">üëÜ ÈªûÊìäÁøªËΩâ</span>`;
        this.cardBack.innerHTML = `<span class="ja-text">${card.ja}</span><span class="romaji-text">${card.romaji}</span>`;
        this.progressText.textContent = `${this.currentIndex + 1}/${this.filteredCards.length}`;
        this.favoriteBtn.classList.toggle('active', this.favorites.includes(card.id));
      }
      updateCards() {
        this.filteredCards = this.getFilteredCards();
        this.renderCardList();
        this.updateCardDisplay();
      }
      prevCard() {
        if (this.filteredCards.length === 0) return;
        this.currentIndex = (this.currentIndex - 1 + this.filteredCards.length) % this.filteredCards.length;
        this.updateCardDisplay();
        this.updateListActive();
      }
      nextCard() {
        if (this.filteredCards.length === 0) return;
        this.currentIndex = (this.currentIndex + 1) % this.filteredCards.length;
        this.updateCardDisplay();
        this.updateListActive();
      }
      toggleFavorite() {
        if (this.filteredCards.length === 0) return;
        const card = this.filteredCards[this.currentIndex];
        const idx = this.favorites.indexOf(card.id);
        if (idx === -1) this.favorites.push(card.id);
        else this.favorites.splice(idx, 1);
        localStorage.setItem('jp_favorites', JSON.stringify(this.favorites));
        this.favoriteBtn.classList.toggle('active', idx === -1);
        this.favoriteBtn.classList.add('pop');
        setTimeout(() => this.favoriteBtn.classList.remove('pop'), 200);
        const listItem = this.cardList.querySelectorAll('.card-item')[this.currentIndex];
        if (listItem) listItem.classList.toggle('favorited', idx === -1);
      }
      toggleFavoriteFilter() {
        this.showingFavoritesOnly = !this.showingFavoritesOnly;
        this.favFilterBtn.classList.toggle('active', this.showingFavoritesOnly);
        this.currentIndex = 0;
        this.updateCards();
      }
      toggleTheme() {
        this.isDarkMode = !this.isDarkMode;
        localStorage.setItem('jp_darkMode', this.isDarkMode);
        this.applyTheme();
      }
      applyTheme() {
        document.body.classList.toggle('light-mode', !this.isDarkMode);
        this.themeToggle.textContent = this.isDarkMode ? '‚òÄÔ∏è' : 'üåô';
      }
    }
    document.addEventListener('DOMContentLoaded', () => { new App().init(); });
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(e => console.log('SW error:', e));
    }
  </script>
</body>
</html>
